<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>Exercise 3: Compute</title>
  <script src="scripts/clipboard.min.js"></script>
  <script src="scripts/copybutton.js"></script>

<style>
    html, body, footer {
        font-family: "Open Sans","Helvetica Neue",Helvetica,Arial,sans-serif;
        margin: 1em;
    }

    img:not(.clipboard){
        max-width: 100%;
        height: auto;
        width: auto;
    }

    /* Copy buttons */
    button.copybtn {
        webkit-transition: opacity .3s ease-in-out;
        -o-transition: opacity .3s ease-in-out;
        transition: opacity .3s ease-in-out;
        opacity: 0;
        padding: 2px 6px;
        position: absolute;
        right: 4px;
        top: 4px;
    }
    div.sourceCode:hover .copybtn, div.sourceCode .copybtn:focus {
        opacity: .3;
    }
    div.sourceCode .copybtn:hover {
        opacity: 1;
    }
    div.sourceCode {
        position: relative;
    }
    .xmodule_display.xmodule_HtmlBlock ol {
        padding: 0 0 0 2em !important;
    }
    .xmodule_display.xmodule_HtmlBlock ul {
        padding: 0 0 0 2em !important;
    }

    code {
        padding: 2px 4px !important;
        background-color: #eee !important;
        border-radius: 4px;
    }
    pre code {
        padding: 9.5px !important;
        background-color: #f5f5f5 !important;
        display: block;
        overflow-x: auto;
        margin: 0 0 10px;
        font-size: 13px;
        line-height: 1.42857143;
        word-break: break-all;
        word-wrap: break-word;
        border: 1px solid #ccc;
        border-radius: 4px;
        white-space: pre;
    }
    pre code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    pre code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    pre code span.at { color: #7d9029; } /* Attribute */
    pre code span.bn { color: #40a070; } /* BaseN */
    pre code span.bu { color: #06287e; } /* BuiltIn */
    pre code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    pre code span.ch { color: #4070a0; } /* Char */
    pre code span.cn { color: #880000; } /* Constant */
    pre code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    pre code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    pre code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    pre code span.dt { color: #902000; } /* DataType */
    pre code span.dv { color: #40a070; } /* DecVal */
    pre code span.er { color: #ff0000; font-weight: bold; } /* Error */
    pre code span.ex { color: #06287e; } /* Extension */
    pre code span.fl { color: #40a070; } /* Float */
    pre code span.fu { color: #06287e; } /* Function */
    pre code span.im { } /* Import */
    pre code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    pre code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    pre code span.op { color: #666666; } /* Operator */
    pre code span.ot { color: #007020; } /* Other */
    pre code span.pp { color: #bc7a00; } /* Preprocessor */
    pre code span.sc { color: #4070a0; } /* SpecialChar */
    pre code span.ss { color: #bb6688; } /* SpecialString */
    pre code span.st { color: #4070a0; } /* String */
    pre code span.va { color: #19177c; } /* Variable */
    pre code span.vs { color: #4070a0; } /* VerbatimString */
    pre code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

    footer {
        padding-top: 3em;
        font-style: italic;
        font-size: .9em;
    }
</style>
<body>
<p><em>[version_1.1]</em></p>
<div style="background-color: #FFD2D2; padding: 15px; margin-bottom: 25px">
<h3>
<span class="fa fa-info-circle"></span> Note
</h3>
<p>The exercises in this course will have an associated charge in your AWS account. In this exercise, you create or use the following resources:</p>
<ul>
<li>AWS Identity and Access Management (IAM) policy and user (policies and users are AWS account features, offered at no additional charge)</li>
<li>Amazon Elastic Compute Cloud (Amazon EC2) instance</li>
</ul>
<p>Familiarize yourself with <strong><a href="https://aws.amazon.com/ec2/pricing/" target="_blank">Amazon EC2 pricing</a></strong> and the <strong><a href="https://aws.amazon.com/free/" target="_blank">AWS Free Tier</a></strong>.</p>
</div>
<h1 id="exercise-3-launching-an-ec2-instance">Exercise 3: Launching an EC2 Instance</h1>
<p>For this scenario, you create the employee directory application by using user data that you configure when you set up the EC2 instance.</p>
<p>In this exercise, you log in to the console as the IAM <em>Admin</em> user. You then launch an EC2 instance by using the IAM role that you created previously. Finally, after you create the employee directory application, you stop and then terminate the instance. Because this instance launch is a dry run, you terminate the instance to prevent additional costs from incurring.</p>
<h2 id="task-1-launching-an-ec2-instance-that-uses-a-role">Task 1: Launching an EC2 instance that uses a role</h2>
<p>In this task, you will launch an EC2 instance that hosts the employee directory application.</p>
<ol type="1">
<li><p>If needed, log in to the AWS Management Console as your <em>Admin</em> user.</p></li>
<li><p>In the <strong>Services</strong> search bar, search for <strong>EC2</strong>, and open the service by choosing <strong>EC2</strong>.</p></li>
<li><p>In the navigation pane, under <strong>Instances</strong> choose <strong>Instances</strong>.</p></li>
<li><p>Choose <strong>Launch instances</strong>.</p></li>
<li><p>For <strong>Name</strong> use <code>employee-directory-app</code>.</p></li>
<li><p>Under <strong>Application and OS Images (Amazon Machine Image)</strong>, choose the default <strong>Amazon Linux 2023</strong>.</p></li>
<li><p>Under <strong>Instance type</strong>, select <strong>t2.micro</strong>.</p></li>
<li><p>Under <strong>Key pair (login)</strong>, choose <strong>Create a new key pair</strong>.</p></li>
<li><p>For <strong>Key pair name</strong>, paste <code>app-key-pair</code>. Choose <strong>Create key pair</strong>. The required <strong>.pem</strong> file should automatically download for you.</p></li>
<li>Under <strong>Network settings</strong> and <strong>Edit</strong>: Keep the default VPC selection, which should have <em>(default)</em> after the network name
<ul>
<li><strong>Subnet</strong>: Choose the first subnet in the dropdown list</li>
<li><strong>Auto-assign Public IP</strong>: <em>Enable</em></li>
</ul></li>
<li><p>Under <strong>Firewall (security groups)</strong> choose <strong>Create security group</strong> use <code>app-sg</code> for the <strong>Security group name</strong> and <strong>Description</strong>.</p></li>
<li><p>Under <strong>Inbound security groups rules</strong> choose <strong>Remove</strong> above the <strong>ssh</strong> rule.</p></li>
<li><p>Choose <strong>Add security group rule</strong>. For <strong>Type</strong> choose <strong>HTTP</strong>. Under <strong>Source type</strong> choose <strong>Anywhere</strong>.</p></li>
<li><p>Expand <strong>Advanced details</strong> and under <strong>IAM instance profile</strong> choose <strong>S3DynamoDBFullAccessRole</strong>.</p></li>
<li><p>In the <strong>User data</strong> box, paste the following code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" title="1"><span class="co">#!/bin/bash -ex</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="fu">wget</span> https://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/DEV-AWS-MO-GCNv2/FlaskApp.zip</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="fu">unzip</span> FlaskApp.zip</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="bu">cd</span> FlaskApp/</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="ex">yum</span> -y install python3-pip</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="ex">pip</span> install -r requirements.txt</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="ex">yum</span> -y install stress</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="bu">export</span> <span class="va">PHOTOS_BUCKET=${SUB_PHOTOS_BUCKET}</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="bu">export</span> <span class="va">AWS_DEFAULT_REGION=</span><span class="op">&lt;</span><span class="ex">INSERT</span> REGION HERE<span class="op">&gt;</span></a>
<a class="sourceLine" id="cb1-10" title="10"><span class="bu">export</span> <span class="va">DYNAMO_MODE=</span>on</a>
<a class="sourceLine" id="cb1-11" title="11"><span class="va">FLASK_APP=</span>application.py <span class="ex">/usr/local/bin/flask</span> run --host=0.0.0.0 --port=80</a></code></pre></div></li>
<li><p>In the pasted code, change the following line to match your Region (your Region is listed at the top right, next to your user name):</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb2-1" title="1"><span class="bu">export</span> <span class="va">AWS_DEFAULT_REGION=</span><span class="op">&lt;</span><span class="ex">INSERT</span> REGION HERE<span class="op">&gt;</span></a></code></pre></div>
<p>Example:</p>
<p>The following example uses the US West (Oregon) Region, or <em>us-west-2</em>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="bu">export</span> <span class="va">AWS_DEFAULT_REGION=</span>us-west-2</a></code></pre></div>
<p><strong>Note:</strong> In a later lab, you will modify this user data script again to use your Amazon Simple Storage Service (Amazon S3) bucket. For now, keep <strong><code>${SUB_PHOTOS_BUCKET}</code></strong> in the script.</p></li>
<li><p>Choose <strong>Launch instance</strong>.</p></li>
<li><p>Choose <strong>View all instances</strong>.</p>
<p>The instance should now be listed under <strong>Instances</strong>.</p></li>
<li><p>Wait for the <strong>Instance state</strong> to change to <em>Running</em> and the <strong>Status check</strong> to change to <em>2/2 checks passed</em>.</p>
<p><strong>Note</strong>: Often, the status checks update, but the console user interface (UI) might not update to reflect the most recent information. You can minimize waiting by refreshing the page after a few minutes.</p></li>
</ol>
<h2 id="task-2.-viewing-the-application">Task 2. Viewing the application</h2>
<p>In this task, you will view the application that’s running on the instance in a web browser window.</p>
<ol type="1">
<li><p>Select the instance by selecting its check box.</p>
<p>Instance information should load on the tabs in the pane.</p></li>
<li><p>On the <strong>Details</strong> tab, copy the <strong>Public IPv4 address</strong>.</p>
<p><strong>Note</strong>: Make sure that you only copy the address instead of choosing the <strong>open address</strong> link.</p></li>
<li><p>In a new browser window, paste the IP address that you copied. <em>Make sure to remove the ‘S’ after HTTP so you are using only HTTP instead</em>.</p>
<p>You should see an <strong>Employee Directory</strong> placeholder. Right now, you won’t be able to interact with it yet because the application isn’t connected to a database.</p>
<p>Congratulations! You have successfully created an EC2 instance, which hosts the employee directory application.</p>
<p>After you finish exploring the instance, you will stop and terminate your instance so that you don’t incur future costs.</p></li>
</ol>
<h2 id="task-3.-cleaning-up">Task 3. Cleaning up</h2>
<p>In this task, you will terminate the EC2 instance that you launched.</p>
<ol type="1">
<li><p>Go back to the AWS Management Console.</p>
<p>The <em>employee-directory-app</em> instance should still be selected.</p></li>
<li><p>At the top of the console pane, choose <strong>Instance state</strong>, choose <strong>Stop instance</strong>, and choose <strong>Stop</strong>.</p>
<p>The status in the <strong>Instance state</strong> column will eventually go into the <em>Stopped</em> state.</p>
<p>Next, you will terminate the instance.</p></li>
<li><p>Make sure that check box next to the instance <strong>Name</strong> is selected.</p></li>
<li><p>Choose <strong>Instance state</strong>, choose <strong>Terminate instance</strong>, and choose <strong>Terminate</strong>.</p></li>
</ol>
<script>
document.body.innerHTML = document.body.innerHTML.replace(/RELATIVE(.+)RELATIVE/g, function (match, capture) {
  let tmp = document.createElement("DIV");
  tmp.innerHTML = capture;
  return new URL(tmp.textContent || tmp.innerText || "", document.baseURI).href;
});
</script>
</body>
<footer>
    <p>© 2022 Amazon Web Services, Inc. or its affiliates. All rights reserved. This work may not be reproduced or redistributed, in whole or in part, without prior written permission from Amazon Web Services, Inc. Commercial copying, lending, or selling is prohibited. Corrections, feedback, or other questions? Contact us at <a href="https://support.aws.amazon.com/#/contacts/aws-training" target="_blank">https://support.aws.amazon.com/#/contacts/aws-training</a>. All trademarks are the property of their owners.</p>
</footer>
</html>
